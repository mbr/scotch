{% with c = app['config']['nginx'],
        submount = (c['url_path'] != '/') %}

{%- if submount -%}
location = /c['url_path'] {
  rewrite ^ /{{c['url_path']}}/;
}

{% endif %}
location @{{c['url_path']}} {
  include uwsgi_params;
  uwsgi_pass unix:/tmp/uwsgi.sock;
  {% if submount %}
  uwsgi_param SCRIPT_NAME /{{c['url_path']}};
  uwsgi_modifier1 30;  // remove SCRIPT_NAME from PATH_INFO
  {% endif %}
}

{% endwith %}
